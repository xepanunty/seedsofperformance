TZ_Portfolio_PlusAddOnContentVote=window.TZ_Portfolio_PlusAddOnContentVote||{basePath:"",addonId:0,articleId:0,referView:"",referModule:"",referLayout:""},function(t,e,o,a,r,i){"use strict";t.tzPortfolioPlusAddOnVote=function(n,d){var l=t.tzPortfolioPlusAddOnVote,s=t(n),f=t.extend(!0,t.extend(!0,{},t.tzPortfolioPlusAddOnVote.defaults),d),c=!1,u=f.loadingTemplate,p=f.notification,m=f.basePath;return m||(m=i.basePath),/\/$/.test(m)||(m+="/"),u=u.replace("{basepath}",m),s.processVote=function(r){f.beforeVote();var n="",m={},P=t(u);r.parents(f.mainSelector).append(P),f.ajaxUrl?n=f.ajaxUrl:(n="index.php?option=com_tz_portfolio_plus&view=addon&addon_task=vote.vote",m.addon_id=r.data("rating-addon-id")?r.data("rating-addon-id"):f.addonId,r.data("rating-addon-id")||d.addonId||(m.addon_id=i.addonId),m.cid=r.data("rating-article-id")?r.data("rating-article-id"):f.articleId,r.data("rating-article-id")||d.articleId||(m.cid=i.articleId),m.user_rating=r.data("rating-point")?r.data("rating-point"):f.ratingPoint,f.referView&&(m.referview=f.referView),!d.referView&&i.referView&&(m.referview=i.referView),f.referModule&&(m.refermodule=f.referModule),!d.referModule&&i.referModule&&(m.refermodule=i.referModule),f.referLayout&&(m.referlayout=f.referLayout),!d.referLayout&&i.referLayout&&(m.referlayout=i.referLayout),f.Itemid&&(m.Itemid=f.Itemid)),void 0!==l._notification&&l._notification.dismiss(),t.ajax({url:n,type:f.ajaxType,data:m,dataType:f.ajaxDataType}).done(function(i){if(1==i.success&&!t.isEmptyObject(i.data)){var n=r.parents(f.mainSelector),d=i.data.rating_count,u=i.data.rating_sum/d,m=n.find(f.itemSelector),g=t(f.votedTemplate?f.votedTemplate:"<span></span>");if(f.votedTemplate||g.addClass(m.clone().removeClass(f.votedClass).attr("class")),m.removeClass(f.votedClass).html("").not(":lt("+(5-Math.ceil(u))+")").addClass(f.votedClass),u-parseInt(u)>0&&(g.css("width",100-Math.round(100*(u-parseInt(u)))+"%"),m.eq(5-Math.ceil(u)).html(g)),n.find(f.counterSelector).length){var V=a.JText._("PLG_CONTENT_VOTE_VOTES"),v=f.votedCounterTpl;i.data.rating_count<2&&(V=a.JText._("PLG_CONTENT_VOTE_VOTES_1")),V=V.replace("%d",i.data.rating_count),v=v.replace("{votedcounter}",V),n.find(f.counterSelector).html(v)}l.originalJS||s.itemClick(n.find(f.itemSelector))}f.ajaxComplete(i,n,d,u);var _=new o.NotificationFx({wrapper:p.wrapper?p.wrapper:e.body,message:i.message,layout:p.layout,effect:p.effect,type:1!=i.success?"success":"error",ttl:p.ttl,onOpen:function(){t(_.options.wrapper).find(_.ntf).width("auto"),p.onOpen()},onClose:function(){p.onClose()}});l._notification=_,_.show(),P.remove(),c=!1}),f.afterVote(s)},s.itemClick=function(e){e.off("click").on("click",function(e){if(e.preventDefault(),!c){c=!0;var o=t(this);s.processVote(o)}})},l.originalJS?s.processVote(s):s.itemClick(s.find(f.itemSelector)),void 0!==typeof r.infiniteScroll&&void 0!==r.infiniteScroll.addAjaxComplete&&r.infiniteScroll.addAjaxComplete(function(t,e){var o=t.find(f.mainSelector);o.tzPortfolioPlusAddOnVote(f),f.ajaxScrollComplete(o,t,e)}),s.vars=f,t.data(n,"tzPortfolioPlusAddOnVote",s),this},t.tzPortfolioPlusAddOnVote.originalJS=!1,t.tzPortfolioPlusAddOnVote.defaults={basePath:"",ajaxUrl:"",ajaxType:"POST",ajaxDataType:"json",counterSelector:".js-tpp-counter",mainSelector:".content_rating",itemSelector:".rating > a",addonId:0,referModule:"",referView:"",referLayout:"",articleId:0,ratingPoint:0,ratingCount:0,ratingTotal:0,ratingMax:5,votedClass:"voted",votedTemplate:"",votedCounterTpl:"<small>({votedcounter})</small>",loadingTemplate:'<img src="{basepath}images/loading.gif" class="loading" border="0" align="absmiddle" /> ',notification:{wrapper:e.body,layout:"growl",effect:"scale",ttl:3e3,onClose:function(){return!1},onOpen:function(){return!1}},beforeVote:function(){},afterVote:function(){},ajaxComplete:function(t){},ajaxScrollComplete:function(t,e,o){}},t.fn.tzPortfolioPlusAddOnVote=function(e){if(void 0===e&&(e={}),"object"==typeof e)return this.each(function(o,a){void 0===t(this).data("tzPortfolioPlusAddOnVote")?new t.tzPortfolioPlusAddOnVote(this,e):t(this).data("tzPortfolioPlusAddOnVote")})},o.JVXVote=function(e,o,a,r,i,n,d){t.tzPortfolioPlusAddOnVote.originalJS=!0;var l=t(e),s=l.data("tzPortfolioPlusAddOnVote");void 0!==s&&s.processVote(l),l.tzPortfolioPlusAddOnVote({mainSelector:".content_rating",itemSelector:".rating > a",counterSelector:"#TzVote_"+o,articleId:o,ratingPoint:a,ratingTotal:r,ratingCount:i})}}(jQuery,document,window,Joomla,TZ_Portfolio_Plus,TZ_Portfolio_PlusAddOnContentVote);